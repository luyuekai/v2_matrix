<!-- Breadcrum Zone -->
<ol class="breadcrumb" style="margin-top:-20px;margin-left:-20px">
  <li><a href="index.html">Home</a></li>
  <li class="active">Page Matrix</li>
</ol>

<!-- Content Header  -->
<h1><i class="fa fa-tasks"></i> Page Matrix <small>(JobRecall Business Example)</small> </h1>


<!-- Content Zone -->
<!-- Statistic Zone Begin-->
<div class="row">
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card yellow summary-inline">
        <div class="card-body">
          <i class="icon fa fa-bed fa-4x"></i>
          <div class="content">
            <div class="title">50</div>
            <div class="sub-title">Pending</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card blue summary-inline">
        <div class="card-body">
          <i class="icon fa fa-sliders fa-4x"></i>
          <div class="content">
            <div class="title">23</div>
            <div class="sub-title">Running</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card green summary-inline">
        <div class="card-body">
          <i class="icon fa fa-check fa-4x"></i>
          <div class="content">
            <div class="title">280</div>
            <div class="sub-title">Success</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card dark summary-inline">
        <div class="card-body">
          <i class="icon fa fa-remove fa-4x"></i>
          <div class="content">
            <div class="title">16</div>
            <div class="sub-title">Failed</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card red summary-inline">
        <div class="card-body">
          <i class="icon fa fa-trash fa-4x"></i>
          <div class="content">
            <div class="title">280</div>
            <div class="sub-title">Killed</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
  <div class="col-lg-2 col-md-6 col-sm-6 col-xs-12">
    <a href="#">
      <div class="card green summary-inline">
        <div class="card-body">
          <i class="icon fa fa-bars fa-4x"></i>
          <div class="content">
            <div class="title">16</div>
            <div class="sub-title">Total</div>
          </div>
          <div class="clear-both"></div>
        </div>
      </div>
    </a>
  </div>
</div>
<!-- Statistic Zone End-->

<div class="row">
  <!-- Left Side Control Panel -->
  <!-- <div class="col-xs-3">

  </div> -->



  <!-- Right Side Context Panel -->
  <div class="col-xs-12">
    <div class="row" id="tableDIV">
      <!-- 文件列表区域 -->
      <div class="col-xs-12">
        <div class="card card-success">
          <div class="card-header">
            <div class="card-title">
              <div class="title"><i class="fa fa-table"></i> Table server side paging example
                <small>(&nbsp;Total counts:
                  <strong data-bind="text: totalCounts()"></strong>&nbsp;)</small>
              </div>
            </div>
            <div class="pull-right card-action">
              
            </div>
          </div>
          <br>
          <div class="row" data-bind="visible: viewData().length<1">
            <div class="col-md-12">
              <div class="card green summary-inline">
                <div class="card-body">
                  <i class="icon fa fa-info-circle fa-1x"> &nbsp;<strong>Information</strong></i>
                </div>
                <div class="row text-center" style="font-size:28px">
                  <div class="col-md-12">
                    <i class="fa fa-bullhorn fa-1x"></i> <span id="infoMessage">Currently no result return, please select one Entity and searching ...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body" data-bind="visible: viewData().length>0">

            <form class="navbar-form navbar-right" role="search">
              <div class="form-group">
                <input data-bind="value:searchKeyword" class="form-control" placeholder="输入关键字" type="text">
              </div>
              <button data-bind="click:function(){searchByKeyword()}" type="submit" class="btn btn-success">搜索</button>
            </form>
            <table class="table table-striped" cellspacing="0">
              <thead>
                <tr>
                  <!-- ko foreach: columnNames -->
                  <th>
                    <span data-bind="text: $data"></span>
                  </th>
                  <!-- /ko -->
                </tr>
              </thead>
              <tbody data-bind="foreach: viewData">
                <tr data-bind="foreach: $data">
                  <td data-bind="text: $data"></td>
                </tr>
              </tbody>
            </table>

            <!-- <table class="table table-striped" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th>id</th>
                </tr>
              </thead>
              <tbody data-bind="foreach: viewData">
                <tr>
                  <td data-bind="text:id">
                  </td>
                </tr>
              </tbody>
            </table> -->

            <div id="pagingDIV">

              <nav>

                <ul class="pager">
                  <span class="pull-right">
                    <select class="form-control" style="width:88px" data-bind="options:pagingSizeArray,value:pageMaxSize"></select>
                  </span>
                  <li><a data-bind="click:function(){toPage(1)}" href="#">首页</a></li>
                  <li><a data-bind="click:function(){toPage(currentPageNumber()-1)}" href="#">前翻</a></li>
                  <li>
                    <input data-bind="value:currentPageNumber" style="width:38px" ;type="text" class="text-center">
                  </li>
                  <li><a data-bind="click:function(){toPage(currentPageNumber()+1)}" href="#">后翻</a></li>
                  <li><a data-bind="click:function(){toPage(totalPage())}" href="#">末页</a></li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var retrieveData = function() {
    LoaderUtil.add('tableDIV');

    var queryPOJO = ClonePOJO.shallowClone(ServerPagingQueryPOJO.queryPOJO);


    var likeVar = {
      'name': viewModel.searchKeyword()
    }
    var eqVar = {};
    var inVar = {};
    $(queryPOJO).attr("className", "JobRecall");
    $(queryPOJO).attr("aliasMap", {});
    $(queryPOJO).attr("orderMap", {"startedTime": false,"jobId": true});
    $(queryPOJO).attr("pageMaxSize", viewModel.pageMaxSize());
    $(queryPOJO).attr("currentPageNumber", viewModel.currentPageNumber());
    $(queryPOJO).attr("likeORMap", likeVar);
    $(queryPOJO).attr("eqMap", eqVar);
    $(queryPOJO).attr("inMap", inVar);

    ServerPagingQueryPOJO.search(queryPOJO, "SEARCH_SUCCESS_TEST");
  }
  $.subscribe("SEARCH_SUCCESS_TEST", successListener);
  $.subscribe("PAGING_SEARCH_FAILED", failedListener);

  function failedListener() {
    console.log(arguments[1]);
    // if (arguments && arguments[1]) {
    //   var errorMessage = arguments[1].errorMessage;
    //   responseViewModel.errorResponse(errorMessage)
    // }
    // LoaderUtil.remove('tableDIV');
    setTimeout(removeLoader, 1000);
  }

  function successListener() {
    if (arguments && arguments[1]) {
      var headers = AlgorithmPOJO.buildKeys(arguments[1].result);
      // viewModel.buildData(arguments[1]);
      viewModel.buildSearchData(arguments[1]);
    }
    setTimeout(removeLoader, 500);

  }


  function removeLoader() {
    LoaderUtil.remove('tableDIV');
  }


  var viewModel = new ServerPagingViewModel();
  ko.applyBindings(viewModel, document.getElementById('tableDIV'));
  viewModel.retrieveData = retrieveData;
  viewModel.retrieveData();
</script>

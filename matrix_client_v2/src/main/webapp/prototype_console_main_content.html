<!-- Breadcrum Zone -->
<ol class="breadcrumb" style="margin-top:-20px;margin-left:-20px">
  <li><a href="index.html">Home</a></li>
  <li class="active">Matrix Prototype</li>
</ol>

<!-- Content Header  -->
<h3><i class="fa fa-tasks"></i> Matrix Prototype <small>(Implement by Matrix)</small> </h3>


<!-- Content Zone -->
<!-- Statistic Zone Begin-->
<!-- Statistic Zone End-->


<div class="row">
  <!-- Left Side Control Panel -->
  <!-- <div class="col-xs-3">

  </div> -->
  <!-- Right Side Context Panel -->
  <div class="col-xs-12">
    <div id="response_div">
      <div class="alert fresh-color" data-bind="css:styleClass,visible:resultVisible">
        <strong>
          <span data-bind="text:resultTitle"></span>
        </strong>
        <span data-bind="text:resultSubTitle"></span>
        <div data-bind="text:resultContent"></div>
      </div>
    </div>
  </div>
</div>

<div class="panel fresh-color panel-primary" style="border: 0px solid;" id="tableDIV">
  <div class="panel-heading"><i class="fa fa-table"></i> &nbsp;Matrix Prototype Overview
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="switch_div_display('common_table_div');switch_div_display('special_table_div');ServerPagingQueryPOJO.example_query_action()">
      <div class="title"><i class="fa fa-barcode"></i></div>
    </button>
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="viewModel.retrieveData()">
      <div class="title"><i class="fa fa-search"></i></div>
    </button>
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="ModalUtil.popup_modal('Add Entity Operation', '/prototype_console_main_content_modal_add.html', null, null, null);">
      <div class="title"><i class="fa fa-plus"></i></div>
    </button>
  </div>
  <div class="panel-body">

    <div data-bind="if:!hasServerResponse()">
      <div class="alert alert-success alert-dismissible fresh-color" role="alert" style="margin-top: 16px;">
        <strong><i class="fa fa-warning"></i>&nbsp;信息:</strong> &nbsp;Table Not Initialized! Please load data first!
      </div>
    </div>
    <div data-bind="if:hasServerResponse()">
      <div class="row" id='common_table_div' style="display:none">
        <div class="col-md-12" style="overflow: auto">
          <table class="table table-striped" cellspacing="0">
            <thead>
              <tr>
                <!-- ko foreach: columnNames -->
                <th>
                  <span data-bind="text: $data"></span>
                </th>
                <!-- /ko -->
              </tr>
            </thead>
            <tbody data-bind="foreach: viewData">
              <tr data-bind="foreach: $data">
                <td data-bind="text: $data"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="row" id='special_table_div'>
        <div class="col-md-12" style="overflow: auto">
          <table class="table table-striped" cellspacing="0" width="100%">
            <thead>
              <tr>
                <th>KEY</th>
                <th>VALUE</th>
                <th>PROJECT</th>
                <th>PRODUCT</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: viewData">
              <tr>
                <td data-bind="text:$data[14]"></td>
                <td data-bind="text:$data[9]"></td>
                <td data-bind="text:$data[30]"></td>
                <td data-bind="text:$data[31]"></td>
                <td>
                  <button type="button" class="btn btn-link" title="update" data-bind="click:(function(){ModalUtil.popup_modal_with_businessPOJO('Update Entity Operation', '/prototype_console_main_content_modal_update.html',$data);})" style="color:#666;margin:-6px -6px -6px -6px">
                    <div class="title"><i class="fa fa-edit fa-1x"></i></div>
                  </button>
                  <button type="button" class="btn btn-link" title="remove" data-bind="click:(function(){ModalUtil.popup_modal_with_businessPOJO('Remove Entity Operation', '/prototype_console_main_content_modal_remove.html',$data);})" style="color:#666;margin:-6px -6px -6px -6px">
                    <div class="title"><i class="fa fa-trash fa-1x"></i></div>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="matrix-pager-example">
        <nav class="matrix-pager " role="navigation">

          <div class="collapse navbar-collapse" id="navbar-collapse-01">

            <ul class="nav navbar-nav navbar-right ">
              <li><a data-bind="click:function(){toPage(1)}" href="#"><i class="fa fa-angle-double-left"></i> &nbsp;首页</a></li>
              <li><a data-bind="click:function(){toPage(currentPageNumber()-1)}" href="#"><i class="fa fa-angle-left"></i> &nbsp;上页</a></li>
              <li>
                <form class="navbar-form navbar-center" action="#" role="search" style="width:68px;margin-left: -20px;">
                  <div class="form-group">
                    <div class="input-group">
                      <input data-bind="value:currentPageNumber" class="form-control text-center" type="search" placeholder="页数" style="width:50px;border-radius: 0px;">
                      <span class="input-group-btn" style="padding-left: 4px;">
                          <button data-bind="visible:false,click:function(){}" type="submit" class="btn"><span class="fui-search"></span></button>
                      </span>
                    </div>
                  </div>
                </form>
              </li>
              <li><a data-bind="click:function(){toPage(currentPageNumber()+1)}" href="#">下页 &nbsp;<i class="fa fa-angle-right"></i></a></li>
              <li><a data-bind="click:function(){toPage(totalPage())}" href="#"> 末页 &nbsp;<i class="fa fa-angle-double-right"></i></a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">每页<span data-bind="text:pageMaxSize()"></span>条<b class="caret"></b></a>
                <span class="dropdown-arrow"></span>
                <ul class="dropdown-menu" data-bind="foreach: pagingSizeArray">
                  <li><a data-bind="click:function(){$parent.pageMaxSize($data)}" href="#"><span data-bind="text:$data"></span></a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-nav">
              <li><a href="#">结果总数:<span data-bind="text:totalCounts()?totalCounts():0"></span>条</a></li>
            </ul>
            <form class="navbar-form navbar-left" action="#" role="search">
              <div class="form-group">
                <div class="input-group">
                  <input data-bind="value:searchKeyword" class="form-control text-center" type="search" placeholder="Search" style="border-radius: 0px;">
                  <span class="input-group-btn" style="padding-left: 4px;">
                        <button style="border-radius: 0px;" data-bind="click:function(){searchByKeyword()}" type="submit" class="btn"><span class="fui-search"></span></button>
                  </span>
                </div>
              </div>
            </form>
          </div>
          <!-- /.navbar-collapse -->
        </nav>
        <!-- /navbar -->
      </div>
    </div>



  </div>
</div>









<div class="modal fade modal-success" id="popupModalPro" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <i class="fa fa-send-o"></i> &nbsp; <span class="modal-title" id="popupModalLabelPro"></span>
      </div>
      <div class="modal-body">
        <div id="modalContentDIVPro"></div>
      </div>
    </div>
  </div>
</div>



<script>
  // *******Server Side Retrieve Data JS Code*******
  var retrieveData = function() {
    // LoaderUtil.add('tableDIV');
    var requestPOJO = {
      "className": "Genericentity",
      "aliasMap": {},
      // "orderMap": {"status": true},
      "pageMaxSize": viewModel.pageMaxSize(),
      "currentPageNumber": viewModel.currentPageNumber(),
      "likeORMap": {
        'name': viewModel.searchKeyword(),
        'description': viewModel.searchKeyword(),
        'stringalpha': viewModel.searchKeyword(),
        'stringbeta': viewModel.searchKeyword()
      },
      "eqMap": {
        "type": "MATRIX_CLIENT_SERVER_REQUEST_DEMO"
      },
      "inMap": {},
    };
    var data = {
      'queryJson': $.toJSON(requestPOJO)
    };

    $.serverRequest($.getServerRoot() + '/service_generic_query/api/query', data, "SEARCH_SUCCESS_LISTENER", "PAGING_SEARCH_FAILED", "SERVICE_GENERIC_QUERY_FAILED");
  }
</script>



<script>
  // *******Server Side Retrieve Data Listener JS Code*******
  $.subscribe("SEARCH_SUCCESS_LISTENER", successListener);
  $.subscribe("PAGING_SEARCH_FAILED", failedListener);
  $.subscribe("SERVICE_GENERIC_QUERY_FAILED", failedServiceListener);

  function failedServiceListener() {
    responseViewModel.errorResponse("SERVICE 'GENERIC QUERY' FAILED! Please contact with the system admin for more information...")
    setTimeout(removeLoader, 500);
  }

  function failedListener() {
    if (arguments && arguments[1]) {
      var errorMessage = arguments[1].errorMessage;
      responseViewModel.errorResponse(errorMessage)
    }
    setTimeout(removeLoader, 500);
  }

  function successListener() {
    if (arguments && arguments[1]) {
      var headers = AlgorithmPOJO.buildKeys(arguments[1].result);
      viewModel.buildSearchData(arguments[1]);
    }
    setTimeout(removeLoader, 500);
  }
</script>

<script>
  // *******Data Bind JS Code*******
  var responseViewModel = new ResponseViewModel();
  ko.applyBindings(responseViewModel, document.getElementById('response_div'));

  var viewModel = new ServerPagingViewModel();
  ko.applyBindings(viewModel, document.getElementById('tableDIV'));
  viewModel.retrieveData = retrieveData;
</script>

<script>
  // *******Other JS Code*******
  function removeLoader() {
    // LoaderUtil.remove('tableDIV');
  }
  // retrieveData();
</script>

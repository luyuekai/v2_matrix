<!-- Breadcrum Zone -->
<ol class="breadcrumb" style="margin-top:-20px;margin-left:-20px">
  <li><a href="index.html">Home</a></li>
  <li><a href="browser_spark.html?app=123">Spark Applications 管理器</a></li>
  <li><a href="browser_spark.html?job=456">Spark Job 管理器</a></li>
  <li class="active">Spark Job 管理器</li>
</ol>

<!-- Content Header  -->
<h5><i class="fa fa-tasks"></i> Job 详情

</h5>


<!-- Content Zone -->
<!-- Statistic Zone Begin-->
<!-- Statistic Zone End-->


<div class="row">
  <!-- Left Side Control Panel -->
  <!-- <div class="col-xs-3">

  </div> -->
  <!-- Right Side Context Panel -->
  <div class="col-xs-12">
    <div id="response_div">
      <div class="alert fresh-color" data-bind="css:styleClass,visible:resultVisible">
        <strong>
          <span data-bind="text:resultTitle"></span>
        </strong>
        <span data-bind="text:resultSubTitle"></span>
        <div data-bind="text:resultContent"></div>
      </div>
    </div>
  </div>
</div>

<div class="card card-success">
  <div class="card-header">
    <div class="card-title">
      <div class="title"><i class="fa fa-cogs"></i> 相关信息</div>
    </div>
    <div class="pull-right card-action">
      <div class="btn-group" role="group" aria-label="..." id="hideFileInfosDIV">
        <button type="button" class="btn btn-link" title="隐藏" onclick="$('#fileInfoContentDIV').css('display', 'none'), $('#displayFileInfosDIV').css('display', ''), $('#hideFileInfosDIV').css('display', 'none')">
          <div class="title"><i class="fa fa-sort-up fa-2x"></i></div>
        </button>
      </div>
      <div class="btn-group" role="group" aria-label="..." id="displayFileInfosDIV" style="display:none">
        <button type="button" class="btn btn-link" title="显示" onclick="$('#fileInfoContentDIV').css('display', ''), $('#hideFileInfosDIV').css('display', ''), $('#displayFileInfosDIV').css('display', 'none')">
          <div class="title"><i class="fa fa-sort-down fa-2x"></i></div>
        </button>
      </div>
    </div>
    <div class="clear-both"></div>
  </div>
  <div class="card profile" id="fileInfoContentDIV">
    <div class="card-body">
      <div class="name"></div>
      <div class="description">
        <div class="row">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>Job ID:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
            <span data-bind="text: 'job_id'"></span>
          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>Name : </strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
            <span data-bind="text: 'collect at <console>:32'"></span>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>状态:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
            <span data-bind="text: 'RUNNING/SUCCESSED'"></span>
          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>日志:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
            <a href="#" onclick="jobManage.jobDetailType = 'logs';
                              $.loadContext('contentDIV', '/assets/self-owned/html/job_browser/job_detail_div.html');"><i class="fa fa-tasks"></i></a>
            <a href="#" onclick="jobManage.jobDetailType = 'logs';
                                      $.loadContext('contentDIV', '/assets/self-owned/html/job_browser/job_detail_div.html');"><i class="fa fa-download"></i></a>
          </div>
        </div>
        <div class="row" data-bind="if:job_detail.maps">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>任务数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>Stage数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
        </div>
        <div class="row" data-bind="if:job_detail.maps">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>活跃任务数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>完成任务数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
        </div>
        <div class="row" data-bind="if:job_detail.maps">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>忽略任务数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>失败任务数:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
        </div>
        <div class="row" data-bind="if:job_detail.maps">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>活跃Stage:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>完成Stage:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
        </div>
        <div class="row" data-bind="if:job_detail.maps">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>忽略Stage:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>失败Stage:</strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">

          </div>
        </div>
        <div class="row">
          <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
            <strong>提交时间: </strong>
          </div>
          <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
            <span data-bind="text:'2016-10-18T09:08:07GMT'"></span>
          </div>
          <div data-bind="if:job_detail.duration">
            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1" style="text-align: right">
              <strong>持续时间(finish time?): </strong>
            </div>
            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
              <span data-bind="text:'2016-10-18T09:08:07GMT'"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<hr>

<div class="panel fresh-color panel-primary panel-card" id="tableDIV">
  <div class="panel-heading"><i class="fa fa-table"></i> &nbsp;Spark Job Stages Overview
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="switch_div_display('common_table_div');switch_div_display('special_table_div');ServerPagingQueryPOJO.example_query_action()">
      <div class="title"><i class="fa fa-barcode"></i></div>
    </button>
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="viewModel.retrieveData()">
      <div class="title"><i class="fa fa-search"></i></div>
    </button>
    <button type="button" class=" btn btn-black btn-xs pull-right" title="" onclick="ModalUtil.popup_modal('Add Entity Operation', '/animal_console_main_content_modal_add.html', null, null, null);">
      <div class="title"><i class="fa fa-plus"></i></div>
    </button>
  </div>
  <div class="panel-body">

    <div data-bind="if:!hasServerResponse()">
      <div class="alert alert-success alert-dismissible fresh-color" role="alert" style="margin-top: 16px;">
        <strong><i class="fa fa-warning"></i>&nbsp;信息:</strong> &nbsp;数据表未初始化,请先加载/查询数据!
      </div>
    </div>
    <div data-bind="if:hasServerResponse()">
      <div class="row" id='common_table_div' style="display:none">
        <div class="col-md-12" style="overflow: auto">
          <table class="table table-striped" cellspacing="0">
            <thead>
              <tr>
                <!-- ko foreach: columnNames -->
                <th>
                  <span data-bind="text: $data"></span>
                </th>
                <!-- /ko -->
              </tr>
            </thead>
            <tbody>
              <tr data-bind="foreach: $data">
                <td data-bind="text: $data"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="row" id='special_table_div'>
        <div class="col-md-12" style="overflow: auto">
          <table class="table table-striped" cellspacing="0" width="100%">
            <thead>
              <tr>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Stage_ID</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">描述</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">提交时间</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">时长</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Tasks</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Input</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Output</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Shuffle Read</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">Shuffle Write</th>
                <th style="padding-left:0px;padding-right:0px;" class="text-left">操作</th>
              </tr>
            </thead>
            <!-- <tbody data-bind="foreach: viewData"> -->
            <tbody>
              <tr>
                <td>
                  <a href="#" data-bind="click:(function(){
                        $('#contentDIV').load($.getRootPath() + '/browser_spark_stage_detail_content.html');
                      })">
                    <span data-bind="text: 'Id'"></span>
                  </a>
                </td>
                <td data-bind="text:'collect at <console>:32'">

                </td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td data-bind="text:''"></td>
                <td>
                  <button type="button" class="btn btn-white-pure" title="update" data-bind="click:(function(){ModalUtil.popup_modal_with_businessPOJO('Update Entity Operation', '/animal_console_main_content_modal_update.html',$data);})">
                    <div class="title"><i class="fa fa-edit fa-1x"></i></div>
                  </button>
                  <button type="button" class="btn btn-white-pure" title="remove" data-bind="click:(function(){ModalUtil.popup_modal_with_businessPOJO('Remove Entity Operation', '/animal_console_main_content_modal_remove.html',$data);})">
                    <div class="title"><i class="fa fa-trash fa-1x"></i></div>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="matrix-pager-example">
        <nav class="matrix-pager " role="navigation">

          <div class="collapse navbar-collapse" id="navbar-collapse-01">

            <ul class="nav navbar-nav navbar-right ">
              <li><a data-bind="click:function(){toPage(1)}" href="#"><i class="fa fa-angle-double-left"></i> &nbsp;首页</a></li>
              <li><a data-bind="click:function(){toPage(currentPageNumber()-1)}" href="#"><i class="fa fa-angle-left"></i> &nbsp;上页</a></li>
              <li>
                <form class="navbar-form navbar-center" action="#" role="search" style="width:68px;margin-left: -20px;">
                  <div class="form-group">
                    <div class="input-group">
                      <input data-bind="value:currentPageNumber" class="form-control text-left" type="search" placeholder="页数" style="width:50px;border-radius: 0px;">
                      <span class="input-group-btn" style="padding-left: 4px;">
                          <button data-bind="visible:false,click:function(){}" type="submit" class="btn"><span class="fui-search"></span></button>
                      </span>
                    </div>
                  </div>
                </form>
              </li>
              <li><a data-bind="click:function(){toPage(currentPageNumber()+1)}" href="#">下页 &nbsp;<i class="fa fa-angle-right"></i></a></li>
              <li><a data-bind="click:function(){toPage(totalPage())}" href="#"> 末页 &nbsp;<i class="fa fa-angle-double-right"></i></a></li>
              <li class="dropup">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">每页<span data-bind="text:pageMaxSize()"></span>条<b class="caret"></b></a>
                <span class="dropdown-arrow"></span>
                <ul class="dropdown-menu" data-bind="foreach: pagingSizeArray">
                  <li><a data-bind="click:function(){$parent.pageMaxSize($data)}" href="#"><span data-bind="text:$data"></span></a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-nav">
              <li><a href="#">结果总数:<span data-bind="text:totalCounts()?totalCounts():0"></span>条</a></li>
            </ul>
            <form class="navbar-form navbar-left" action="#" role="search">
              <div class="form-group">
                <div class="input-group">
                  <input data-bind="value:searchKeyword" class="form-control text-left" type="search" placeholder="Search" style="border-radius: 0px;">
                  <span class="input-group-btn" style="padding-left: 4px;">
                        <button style="border-radius: 0px;" data-bind="click:function(){searchByKeyword()}" type="submit" class="btn"><span class="fui-search"></span></button>
                  </span>
                </div>
              </div>
            </form>
          </div>
          <!-- /.navbar-collapse -->
        </nav>
        <!-- /navbar -->
      </div>
    </div>



  </div>
</div>









<div class="modal fade modal-success" id="popupModalPro" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <i class="fa fa-send-o"></i> &nbsp; <span class="modal-title" id="popupModalLabelPro"></span>
      </div>
      <div class="modal-body">
        <div id="modalContentDIVPro"></div>
      </div>
    </div>
  </div>
</div>



<script>
  // *******Server Side Retrieve Data JS Code*******
  var retrieveData = function() {
    // LoaderUtil.add('tableDIV');
    var requestPOJO = {
      "className": "Genericentity",
      "aliasMap": {},
      // "orderMap": {"status": true},
      "pageMaxSize": viewModel.pageMaxSize(),
      "currentPageNumber": viewModel.currentPageNumber(),
      "likeORMap": {
        'name': viewModel.searchKeyword()
      },
      "eqMap": {
        "deleted": false,
        "type": "MATRIX_YL_DEMO_ANIMAL"
      },
      "inMap": {},
    };
    var data = {
      'queryJson': $.toJSON(requestPOJO)
    };

    $.serverRequest($.getServerRoot() + '/service_generic_query/api/query', data, "SEARCH_SUCCESS_LISTENER", "PAGING_SEARCH_FAILED", "SERVICE_GENERIC_QUERY_FAILED");
  }
</script>



<script>
  // *******Server Side Retrieve Data Listener JS Code*******
  $.subscribe("SEARCH_SUCCESS_LISTENER", successListener);
  $.subscribe("PAGING_SEARCH_FAILED", failedListener);
  $.subscribe("SERVICE_GENERIC_QUERY_FAILED", failedServiceListener);

  function failedServiceListener() {
    responseViewModel.errorResponse("SERVICE 'GENERIC QUERY' FAILED! Please contact with the system admin for more information...")
    setTimeout(removeLoader, 500);
  }

  function failedListener() {
    if (arguments && arguments[1]) {
      var errorMessage = arguments[1].errorMessage;
      responseViewModel.errorResponse(errorMessage)
    }
    setTimeout(removeLoader, 500);
  }

  function successListener() {
    if (arguments && arguments[1]) {
      var headers = AlgorithmPOJO.buildKeys(arguments[1].result);
      viewModel.buildSearchData(arguments[1]);
    }
    setTimeout(removeLoader, 500);
  }
</script>

<script>
  // *******Data Bind JS Code*******
  var responseViewModel = new ResponseViewModel();
  ko.applyBindings(responseViewModel, document.getElementById('response_div'));

  var viewModel = new ServerPagingViewModel();
  ko.applyBindings(viewModel, document.getElementById('tableDIV'));
  viewModel.retrieveData = retrieveData;
  viewModel.retrieveData();
</script>

<script>
  // *******Other JS Code*******
  function removeLoader() {
    // LoaderUtil.remove('tableDIV');
  }
  // retrieveData();
</script>

<div id="genericModalDiv">
  <!--LOADER DIV BEGIN-->
  <div class="loader-container text-center">
    <div class="icon">
      <div class="sk-wave">
        <div class="sk-rect sk-rect1"></div>
        <div class="sk-rect sk-rect2"></div>
        <div class="sk-rect sk-rect3"></div>
        <div class="sk-rect sk-rect4"></div>
        <div class="sk-rect sk-rect5"></div>
      </div>
    </div>
    <div class="title">Loading</div>
  </div>
  <!--LOADER DIV BEGIN-->

  <!--RESULT DISPLAY DIV BEGIN-->
  <div class="flat-matrix">
    <div id="resultDIV" data-bind="visible: hasResult,css: styleClass" class="alert fresh-color">
      <button type="button" class="close" data-bind="click:function(){hasResult(!hasResult)}" aria-label="Close"><i class="fa fa-close"></i></button>
      <strong>
      <span data-bind="text:resultTitle"></span>
    </strong>
      <span data-bind="text:resultSubTitle"></span>
      <div data-bind="text:resultContent"></div>
    </div>
  </div>
  <!--RESULT DISPLAY DIV END-->

  <!--Validation DIV BEGIN-->
  <div class="flat-matrix">
    <div data-bind="visible: hasError" class="alert alert-warning alert-dismissible fresh-color" role="alert">
      <button type="button" data-bind="click:function(){hasError(!hasError)}" class="close" aria-label="Close">
        <i class="fa fa-close"></i>
      </button>
      <strong>Warning:</strong>
      <div id="errorMessagesDIV" data-bind="foreach:errorMessage">
        <div data-bind="text:$data"></div>
      </div>
    </div>
  </div>
  <!--Validation DIV END-->

  <div class="business_div_class" data-bind="if:businessPOJO()">
    <div data-bind="with:businessPOJO">
      <div class="row">
        <div class="col-xs-12">
          <form class="form-horizontal">
            <div class="form-group">
              <div class="col-sm-12">
                <div class="input-group">
                  <span class="input-group-addon" id="basic-addon1">
                    <i class="fa fa-bookmark-o" aria-hidden="true"></i>&nbsp;</span>
                  <input type="text" class="form-control" placeholder="Series Name" aria-describedby="basic-addon1" data-bind="value:series_name">
                </div>
              </div>
              <div class="col-sm-12">
                <div class="input-group">
                  <span class="input-group-addon" id="basic-addon1">
                    <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;</span>
                  <input type="text" class="form-control" placeholder="cat,dog,bird,fish" aria-describedby="basic-addon1" data-bind="value:series_value">
                </div>
              </div>

            </div>
            <div class="form-group">
              <label for="inputPassword3" class="col-sm-2 control-label">Type</label>
              <div class="col-sm-10">
                <div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_align" id="radio_series_type_bar" value="bar"  data-bind="checked: series_type">
                    <label for="radio_series_type_bar" title="left">
                      <i class="fa fa-bar-chart" aria-hidden="true">&nbsp;bar</i>
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_align" id="radio_series_type_line" value="line" data-bind="checked: series_type">
                    <label for="radio_series_type_line" title="center">
                      <i class="fa fa-line-chart" aria-hidden="true">&nbsp;line</i>
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_align" id="radio_series_type_area" value="area" data-bind="checked: series_type">
                    <label for="radio_series_type_area" title="right">
                      <i class="fa fa-area-chart" aria-hidden="true">&nbsp;area</i>
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_align" id="radio_series_type_scatter" value="scatter" data-bind="checked: series_type">
                    <label for="radio_series_type_scatter" title="right">
                      <i class="fa fa-sliders" aria-hidden="true">&nbsp;scatter</i>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group" data-bind="visible:$data.series_type()=='scatter'">
              <label for="inputPassword3" class="col-sm-2 control-label">Scale</label>
              <div class="col-sm-10">
                <div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_scale" id="radio_scale_default" value="default"  data-bind="checked: scale_type">
                    <label for="radio_scale_default" title="Use default">
                      &nbsp;Use default
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_scale" id="radio_scale_series" value="series" data-bind="checked: scale_type">
                    <label for="radio_scale_series" title="Use series">
                      &nbsp;Use series
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_scale" id="radio_scale_manual" value="manual" data-bind="checked: scale_type">
                    <label for="radio_scale_manual" title="Manual">
                      &nbsp;Manual
                    </label>
                  </div>
                  <div class="radio radio-inline">
                    <input type="radio" name="radio_scale" id="radio_scale_disable" value="disable" data-bind="checked: scale_type">
                    <label for="radio_scale_disable" title="Disable">
                      &nbsp;Disable
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group" data-bind="visible:$data.scale_type()=='manual'">
              <div class="col-sm-6">
                <div class="input-group">
                  <span class="input-group-addon" id="basic-addon1">
                    <i class="fa fa-tag" aria-hidden="true"></i>&nbsp;Min</span>
                  <input type="text" class="form-control" placeholder="Min Value" aria-describedby="basic-addon1" data-bind="value:scale_min">
                </div>
              </div>
              <div class="col-sm-6">
                <div class="input-group">
                  <span class="input-group-addon" id="basic-addon1">
                    <i class="fa fa-tag" aria-hidden="true"></i>&nbsp;Max</span>
                  <input type="text" class="form-control" placeholder="Max Value" aria-describedby="basic-addon1" data-bind="value:scale_max">
                </div>
              </div>
            </div>

          </form>
          <div class="flat-matrix">
            <div class="alert alert-success alert-dismissible fresh-color" role="alert" style="margin-top: 16px;">
                <i class="fa fa-book"></i>&nbsp;Please use commas to separate data
            </div>
          </div>
        </div>
      </div>
      <br>
      <div class="pull-right">
        <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
        <button type="button" onclick="execute()" class="btn btn-sm btn-success">Confirm</button>
      </div>

      <br>
    </div>
  </div>
</div>


<script>
  // Initialize the View Model
  // Clean the paging binding nodes
  // Binding the view Model
  var genericModalViewModel = new GenericModalViewModel();
  ko.cleanNode($('#genericModalDiv')[0]);
  ko.applyBindings(genericModalViewModel, document.getElementById('genericModalDiv'));

  // Setup the business model with view model
  (function initialize() {
    // *******YOUR SHOULD CODING IN HERE:*******
    function BusinessPOJO() {
      var self = this;
      self.series_name = ko.observable();
      self.series_value = ko.observable();
      self.series_type = ko.observable('bar');
      self.scale_type = ko.observable('disable');
      self.scale_min = ko.observable(1);
      self.scale_max = ko.observable(10000);
    }
    var businessPOJO = new BusinessPOJO();

    genericModalViewModel.businessPOJO(businessPOJO);
  })();

  function execute() {
    // validation failed
    // show validation error message in the warning DIV...
    if (!genericModalViewModel.validation(businessValidation)) {
      return;
    } else {
      // validation correct
      // do your business...
      runService();
    }
  }

  // *******YOUR SHOULD CODING IN HERE:*******
  var businessValidation = function() {
    var errorMessages = [];
    //validate logic...

    //validate
    ValidationPOJO.validate("Series name", genericModalViewModel.businessPOJO().series_name(), errorMessages, ['KEY_NOT_NULL']);
    ValidationPOJO.validate("Series value", genericModalViewModel.businessPOJO().series_value(), errorMessages, ['KEY_NOT_NULL']);

    var series_type = genericModalViewModel.businessPOJO().series_type();
    var scale_type = genericModalViewModel.businessPOJO().scale_type();
    if(series_type == 'scatter' && scale_type == 'manual'){
      ValidationPOJO.validate("Scale min", genericModalViewModel.businessPOJO().scale_min(), errorMessages, ['KEY_NOT_NULL','KEY_MUST_NUMBER','KEY_NOT_NEGATIVE']);
      ValidationPOJO.validate("Scale max", genericModalViewModel.businessPOJO().scale_max(), errorMessages, ['KEY_NOT_NULL','KEY_MUST_NUMBER','KEY_NOT_NEGATIVE']);
    }

    return errorMessages;
  }

  // *******YOUR SHOULD CODING IN HERE:*******
  var runService = function() {
    LoaderUtil.add_v3('genericModalDiv');

    var series_name = genericModalViewModel.businessPOJO().series_name();
    var series_array = genericModalViewModel.businessPOJO().series_value().split(',');
    var series_type = genericModalViewModel.businessPOJO().series_type();
    var scale_type = genericModalViewModel.businessPOJO().scale_type();
    var scale_setting = null;
    if(series_type == 'scatter'){
      scale_setting ={
        enable:false,
        useData:false,
        min_scale:10,
        max_scale:50,
        min_value:1,
        max_value:10000
      };
      if(scale_type == 'default' || scale_type == 'disable'){

      }else if(scale_type == 'series'){
        scale_setting.enable=true;
        scale_setting.useData = true;
      }else if(scale_type == 'manual'){
        scale_setting.enable=true;
        scale_setting.min_value = genericModalViewModel.businessPOJO().scale_min();
        scale_setting.max_value = genericModalViewModel.businessPOJO().scale_max();
      }
    }

    ChartPOJO.current_chart = chart;




    ChartPOJO.addSeries(chart,series_name,series_type,series_array,scale_setting);
    setTimeout(function() {
      genericModalViewModel.response(true, "Entity Operation", "[Successed]", "Operation Successed, please close the console and reload the data.");
      LoaderUtil.remove_v3('genericModalDiv');
      setTimeout(function() {
        ModalUtil.modal_close('popupModalPro');
      }, 1000);
    }, 500);

  }

</script>

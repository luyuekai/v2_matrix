<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matrix</title>

  <link rel="shortcut icon" href="assets/self-owned/ico/favicon.ico">

  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/vendor.css">
  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/flat-admin.css">

  <!-- Theme -->
  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/theme/blue-sky.css">
  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/theme/blue.css">
  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/theme/red.css">
  <link rel="stylesheet" type="text/css" href="assets/reference/flat-admin/assets/css/theme/yellow.css">

  <link rel="stylesheet" href="assets/reference/codemirror/codemirror.css">
  <style>
  .CodeMirror {
    border: 1px solid #eee;
    height: auto;
  }


  .compile_mode_focus_in{
    padding: 20px;margin: 20px 0;border: 1px solid #eee;border-left-width: 5px;border-radius: 3px;border-left-color: #1b809e;
  }
  .compile_mode_focus_out{
    padding:20px 20px 20px 25px;margin: 20px 0;
  }
  .edit_mode_focus_in{
    padding: 20px;margin: 20px 0;border: 1px solid #eee;border-left-width: 5px;border-radius: 3px;border-left-color: #1abc9c;
  }
  .edit_mode_focus_out{
    padding:20px 20px 20px 25px;margin: 20px 0;
  }
  </style>
</head>

<body>



  <div class="app app-blue-sky">

    <aside class="app-sidebar" id="sidebar">
      <div class="sidebar-header">
        <a class="sidebar-brand" href="#"><span class="highlight">MATRIX V3</span> Portal</a>
        <button type="button" class="sidebar-toggle">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="sidebar-menu">
        <ul class="sidebar-nav">
          <li>
            <a href="./index.html">
              <div class="icon">
                <i class="fa fa-dashboard" aria-hidden="true"></i>
              </div>
              <div class="title">Dashboard</div>
            </a>
          </li>

          <li>
            <a href="./module_report_viewer.html">
              <div class="icon">
                <i class="fa fa-magic" aria-hidden="true"></i>
              </div>
              <div class="title">Report Viewer</div>
            </a>
          </li>
          <li class="active">
            <a href="./module_report_editor.html">
              <div class="icon">
                <i class="fa fa-paint-brush" aria-hidden="true"></i>
              </div>
              <div class="title">Report Editor</div>
            </a>
          </li>
          <li class="">
            <a href="assets/reference/flat-admin/index.html" target="_blank">
              <div class="icon">
                <i class="fa fa-flask" aria-hidden="true"></i>
              </div>
              <div class="title">Template</div>
            </a>
          </li>
        </ul>
      </div>
      <div class="sidebar-footer">
        <ul class="menu">
          <li>
            <a href="/" class="dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-cogs" aria-hidden="true"></i>
            </a>
          </li>
          <li><a href="#"><span class="flag-icon flag-icon-cn flag-icon-squared"></span></a></li>
        </ul>
      </div>
    </aside>


    <div class="app-container">

      <nav class="navbar navbar-default" id="navbar">
        <div class="container-fluid">
          <div class="navbar-collapse collapse in">
            <ul class="nav navbar-nav navbar-mobile">
              <li>
                <button type="button" class="sidebar-toggle">
                  <i class="fa fa-bars"></i>
                </button>
              </li>
              <li class="logo">
                <a class="navbar-brand" href="#"><span class="highlight">MATRIX V3</span> Portal</a>
              </li>
              <li>
                <button type="button" class="navbar-toggle">
                  <img class="profile-img" src="assets/reference/flat-admin/assets/images/profile.png">
                </button>
              </li>
            </ul>
            <ul class="nav navbar-nav navbar-left">
              <li class="navbar-title">Report Editor</li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown notification">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <div class="icon"><i class="fa fa-shopping-basket" aria-hidden="true"></i></div>
                  <div class="title">New Orders</div>
                  <div class="count">0</div>
                </a>
                <div class="dropdown-menu">
                  <ul>
                    <li class="dropdown-header">Ordering</li>
                    <li class="dropdown-empty">No New Ordered</li>
                    <li class="dropdown-footer">
                      <a href="#">View All <i class="fa fa-angle-right" aria-hidden="true"></i></a>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="dropdown notification warning">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <div class="icon"><i class="fa fa-comments" aria-hidden="true"></i></div>
                  <div class="title">Unread Messages</div>
                  <div class="count">99</div>
                </a>
                <div class="dropdown-menu">
                  <ul>
                    <li class="dropdown-header">Message</li>
                    <li>
                      <a href="#">
                        <span class="badge badge-warning pull-right">10</span>
                        <div class="message">
                          <img class="profile" src="https://placehold.it/100x100">
                          <div class="content">
                            <div class="title">"Payment Confirmation.."</div>
                            <div class="description">Alan Anderson</div>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#">
                        <span class="badge badge-warning pull-right">5</span>
                        <div class="message">
                          <img class="profile" src="https://placehold.it/100x100">
                          <div class="content">
                            <div class="title">"Hello World"</div>
                            <div class="description">Marco Harmon</div>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#">
                        <span class="badge badge-warning pull-right">2</span>
                        <div class="message">
                          <img class="profile" src="https://placehold.it/100x100">
                          <div class="content">
                            <div class="title">"Order Confirmation.."</div>
                            <div class="description">Brenda Lawson</div>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li class="dropdown-footer">
                      <a href="#">View All <i class="fa fa-angle-right" aria-hidden="true"></i></a>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="dropdown notification danger">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <div class="icon"><i class="fa fa-bell" aria-hidden="true"></i></div>
                  <div class="title">System Notifications</div>
                  <div class="count">10</div>
                </a>
                <div class="dropdown-menu">
                  <ul>
                    <li class="dropdown-header">Notification</li>
                    <li>
                      <a href="#">
                        <span class="badge badge-danger pull-right">8</span>
                        <div class="message">
                          <div class="content">
                            <div class="title">New Order</div>
                            <div class="description">$400 total</div>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#">
                        <span class="badge badge-danger pull-right">14</span> Inbox
                      </a>
                    </li>
                    <li>
                      <a href="#">
                        <span class="badge badge-danger pull-right">5</span> Issues Report
                      </a>
                    </li>
                    <li class="dropdown-footer">
                      <a href="#">View All <i class="fa fa-angle-right" aria-hidden="true"></i></a>
                    </li>
                  </ul>
                </div>
              </li>
              <li class="dropdown profile">
                <a href="/html/pages/profile.html" class="dropdown-toggle" data-toggle="dropdown">
                  <img class="profile-img" src="assets/reference/flat-admin/assets/images/profile.png">
                  <div class="title">Profile</div>
                </a>
                <div class="dropdown-menu">
                  <div class="profile-info">
                    <h4 class="username">Liu Yang</h4>
                  </div>
                  <ul class="action">
                    <li>
                      <a href="#">
                  Profile
                </a>
                    </li>
                    <li>
                      <a href="#">
                        <span class="badge badge-danger pull-right">5</span> My Inbox
                      </a>
                    </li>
                    <li>
                      <a href="#">
                  Setting
                </a>
                    </li>
                    <li>
                      <a href="#">
                  Logout
                </a>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div class="btn-floating" id="help-actions">
        <div class="btn-bg" style="background-color:#3498db;box-shadow: 0 1px 3px #3498db;"></div>
        <button type="button" class="btn btn-info btn-toggle" data-toggle="toggle" data-target="#help-actions">
          <i class="icon fa fa-plus"></i>
          <span class="help-text">Shortcut</span>
        </button>
        <div class="toggle-content">
          <ul class="actions">
            <li><a href="#">Website</a></li>
            <li><a href="#">Documentation</a></li>
            <li><a href="#">Issues</a></li>
            <li><a href="#">About</a></li>
          </ul>
        </div>
      </div>


      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="card card-mini">
            <div class="card-header">
              <div class="card-title">
                <button title="New report" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-edit"></i></button>
                <button title="Save" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-save"></i></button>
                <button title="Save as template" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-bookmark-o"></i></button>
                <button title="Cut selected cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-cut"></i></button>
                <button title="Copy selected cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-copy"></i></button>
                <button title="Paste selected cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-paste"></i></button>
                <button title="Insert a markdown cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-plus"></i></button>
                <button title="Insert a chart cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-bar-chart"></i></button>
                <button title="Insert a table cell" type="button" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-table"></i></button>
                <button title="Run cell" type="button" onclick="switch_edit2view('testDiv')" class="btn btn-default" style="padding: 6px 12px;margin-bottom: 0px;"><i class="fa fa-play"></i></button>
                <span class="pull-right" style="margin-right:18px">
                  <button type="button" class="btn btn-danger" style="padding: 6px 12px;margin-bottom: 0px;">Unsaved</button>
                  <button type="button" class="btn btn-success" style="padding: 6px 12px;margin-bottom: 0px;">Saved as: Hello Draft</button>
                </span>
              </div>
              <ul class="card-action">
                <li class="dropdown">
                  <a href="/" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-cogs" aria-hidden="true"></i>
                  </a>
                  <ul class="dropdown-menu">
                    <li><a href="#"><i class="fa fa-image"></i> &nbsp;View in report viewer</a></li>
                    <li><a href="#"><i class="fa fa-file-o"></i> &nbsp;Download as markdown</a></li>
                    <li><a href="#"><i class="fa fa-file-code-o"></i> &nbsp;Download as html</a></li>
                    <li><a href="#"><i class="fa fa-file-pdf-o"></i> &nbsp;Download as pdf</a></li>
                  </ul>
                </li>
              </ul>
            </div>
            <div class="card-body no-padding table-responsive">
            </div>
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div class="card card-mini">
            <div class="card-body">

              <div id="testDiv" tabindex="100">
                <span id="testDiv_view">练习区域， 焦点获取， 双击进入编辑模式， 点击Run按钮进入解析模式</span>
                <textarea id="testDiv_edit" style="display:none">练习区域， 焦点获取， 双击进入编辑模式， 点击Run按钮进入解析模式</textarea>
              </div>

              <div class="compile_mode_focus_out">
                <h4>解析模式 当前未获得焦点</h4>
              </div>
              <div class="compile_mode_focus_in">
                <h4>解析模式 当前获得焦点</h4>
              </div>

              <!-- <div  style="padding: 20px;margin: 20px 0;border: 1px solid #eee;border-left-width: 5px;border-radius: 3px;border-left-color: #1b809e;">
                <div id="preview"></div>
              </div> -->

              <div class="edit_mode_focus_in">
<textarea id="code-md" name="code-md">
Markdown: 编辑模式 当前获得焦点
================


Getting the Gist of Markdown's Formatting Syntax
------------------------------------------------

This page offers a brief overview of what it's like to use Markdown.
The [syntax page] [s] provides complete, detailed documentation for
every feature, but Markdown should be very easy to pick up simply by
looking at a few examples of it in action. The examples on this page
are written in a before/after style, showing example syntax and the
HTML output produced by Markdown.

It's also helpful to simply try Markdown out; the [Dingus] [d] is a
web application that allows you type your own Markdown-formatted text
and translate it to XHTML.

**Note:** This document is itself written using Markdown; you
can [see the source for it by adding '.text' to the URL] [src].

  [s]: /projects/markdown/syntax  "Markdown Syntax"
  [d]: /projects/markdown/dingus  "Markdown Dingus"
  [src]: /projects/markdown/basics.text
</textarea>
              </div>
              <div class="edit_mode_focus_out">
<textarea id="code-md-out" name="code-md-out">
Markdown: 编辑模式 当前未获得焦点
================


Getting the Gist of Markdown's Formatting Syntax
------------------------------------------------

This page offers a brief overview of what it's like to use Markdown.
The [syntax page] [s] provides complete, detailed documentation for
every feature, but Markdown should be very easy to pick up simply by
looking at a few examples of it in action. The examples on this page
are written in a before/after style, showing example syntax and the
HTML output produced by Markdown.

It's also helpful to simply try Markdown out; the [Dingus] [d] is a
web application that allows you type your own Markdown-formatted text
and translate it to XHTML.

**Note:** This document is itself written using Markdown; you
can [see the source for it by adding '.text' to the URL] [src].

  [s]: /projects/markdown/syntax  "Markdown Syntax"
  [d]: /projects/markdown/dingus  "Markdown Dingus"
  [src]: /projects/markdown/basics.text
</textarea>
              </div>





            </div>

          </div>
        </div>


      </div>
      <footer class="app-footer" style="margin-top:20px">
        <div class="row">
          <div class="col-xs-12">
            <div class="footer-copyright">
              Copyright © 2017 MATRIX
            </div>
          </div>
        </div>
      </footer>
    </div>

  </div>

  <script type="text/javascript" src="assets/reference/flat-admin/assets/js/vendor.js"></script>
  <script type="text/javascript" src="assets/reference/flat-admin/assets/js/app.js"></script>

  <script src="assets/reference/codemirror/codemirror.js"></script>
  <script src="assets/reference/codemirror/mode/javascript/javascript.js"></script>
  <script src="assets/reference/codemirror/mode/markdown/markdown.js"></script>

  <script src="assets/reference/jquery/jquery-1.11.1.min.js"></script>
  <script src="assets/reference/jquery/jquery.json.js"></script>
  <script src="assets/reference/knockout.js/knockout-3.3.0.js"></script>
  <script src="assets/reference/jquery-tiny-pubsub/tiny-pubsub.js"></script>
  <script src="assets/reference/markdown/markdown.min.js"></script>

  <!-- Javascript for Matrix Self Owned -->
  <script src="assets/self-owned/js/generic/generic_algorithm.js"></script>
  <script src="assets/self-owned/js/generic/generic_cache.js"></script>
  <script src="assets/self-owned/js/generic/generic_charting.js"></script>
  <script src="assets/self-owned/js/generic/generic_csv.js"></script>
  <script src="assets/self-owned/js/generic/generic_cud.js"></script>
  <script src="assets/self-owned/js/generic/generic_modal.js"></script>
  <script src="assets/self-owned/js/generic/generic_query.js"></script>
  <script src="assets/self-owned/js/generic/generic_table.js"></script>
  <script src="assets/self-owned/js/generic/generic_util.js"></script>
  <script src="assets/self-owned/js/generic/generic_validation.js"></script>

  <script src="assets/self-owned/js/report/matrix_report.js"></script>


    <script>


      var editor = CodeMirror.fromTextArea(document.getElementById("code-md"), {
        mode: 'markdown',
        lineNumbers: false,
        theme: "default",
        extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}
      });
      var editor = CodeMirror.fromTextArea(document.getElementById("code-md-out"), {
        mode: 'markdown',
        lineNumbers: false,
        theme: "default",
        extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}
      });


    </script>

    <script>
      $(document).ready(function() {
        new Markdown_Editor(document.getElementById("code-md"), document.getElementById("preview"));
      });
    </script>
    <script>

    function Markdown_Editor(input, preview) {
      if(this && preview){
        this.update = function() {
          preview.innerHTML = markdown.toHTML(input.value);
        };
        input.editor = this;
        this.update();
      }
    }


    $("#testDiv").focusin(function() {

      if(hasCodeMirror('testDiv')){
        resetCssClass('testDiv','edit_mode_focus_in');
      }else{
        resetCssClass('testDiv','compile_mode_focus_in');
      }
    });
    $("#testDiv").focusout(function() {
      // $("#testDiv").css("background","white");
      if(hasCodeMirror('testDiv')){
        resetCssClass('testDiv','edit_mode_focus_out');
      }else{
        resetCssClass('testDiv','compile_mode_focus_out');
      }
    });
resetCssClass('testDiv','compile_mode_focus_out');

$( "#testDiv" ).dblclick(function() {
  // alert( "Handler for .dblclick() called." );
  switch_view2edit('testDiv');
});



function switch_focus(div_id){
  if(hasCodeMirror(div_id)){

  }
}

var markdown_content;
var test_editor;

function hasCodeMirror(div_id){
  var result = false;
  var regex = "#"+div_id+":has(.CodeMirror)";

  var codeMirrorComponents = $(regex);
  if(codeMirrorComponents.length>0){
    result = true;
  }
  return result;
}
function switch_view2edit(div_id){
  // parent div id
  // view div id = parent div id +"_view"
  // edit div id = parent div id +"_edit"

  //get view div id
  var view_div_id = div_id +"_view";
  //get view div inner html
  var content = document.getElementById(view_div_id).innerHTML;
  //set view div invisible
  hide_div(view_div_id);

  //get edit div id
  var edit_div_id = div_id +"_edit";
  //set content in edit div
  if(markdown_content){
    document.getElementById(edit_div_id).innerHTML = markdown_content;
  }
  //render the code mirror style of edit div
  //like this: #testDiv:has(.CodeMirror)
  var regex = "#"+div_id+":has(.CodeMirror)";

  var codeMirrorComponents = $(regex);
  if(codeMirrorComponents.length<1){
  test_editor = CodeMirror.fromTextArea(document.getElementById(edit_div_id), {
      id:'123div',
      mode: 'markdown',
      lineNumbers: false,
      theme: "default",
      extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}
    });
  }

  //set div as edit focus style
  resetCssClass(div_id,'edit_mode_focus_in');
}

function switch_edit2view(div_id){
  // parent div id
  // view div id = parent div id +"_view"
  // edit div id = parent div id +"_edit"

  //get view div id
  var view_div_id = div_id +"_view";
  var view_div_element = document.getElementById(view_div_id);
  if(view_div_element && test_editor){
  markdown_content = test_editor.getValue();
    view_div_element.innerHTML = markdown.toHTML(markdown_content);
  }

  //set view div visible
  show_div(view_div_id);

  //delete code mirror textarea
  $( "#"+div_id ).find( ".CodeMirror" ).remove();
}

    </script>
</body>

</html>
